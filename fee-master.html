<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit - Master Finance Control</title>
    <style>
        :root {
            --royal-blue: #002366; --gold: #D4AF37; --deep-gold: #aa8a2e;
            --light-gold: #FDFBF0; --white: #ffffff; --accent-purple: #8e44ad;
            --danger-red: #e74c3c;
        }

        body { background: var(--light-gold); margin: 0; padding: 20px; font-family: 'Georgia', serif; color: var(--royal-blue); }
        .container { max-width: 1200px; margin: 0 auto; background: var(--white); padding: 30px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .header { text-align: center; border-bottom: 3px double var(--gold); margin-bottom: 30px; padding-bottom: 10px; }
        .logo-img { max-width: 120px; margin-bottom: 10px; }

        .form-section { margin-bottom: 25px; border: 1px solid #ddd; padding: 20px; border-radius: 5px; position: relative; background: #fcfcfc; }
        .transport-section { border: 2px solid var(--accent-purple); background: #f9f4ff; }
        
        .section-title { position: absolute; top: -12px; left: 15px; background: white; padding: 0 10px; font-weight: bold; color: var(--deep-gold); text-transform: uppercase; font-size: 0.8rem; }

        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .field-group { display: flex; flex-direction: column; }
        label { font-size: 0.75rem; margin-bottom: 5px; color: #555; font-weight: bold; }

        input, select { padding: 10px; border: 1px solid #ccc; border-bottom: 2px solid var(--gold); font-size: 0.9rem; outline: none; }
        
        .main-btn { width: 100%; padding: 15px; background: var(--royal-blue); color: var(--gold); border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 15px; transition: 0.3s; }
        .trans-btn { background: var(--accent-purple); color: white; }
        .main-btn:hover { filter: brightness(1.2); }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.85rem; background: white; }
        th { background: var(--royal-blue); color: var(--gold); padding: 12px; border: 1px solid var(--gold); }
        td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        
        .tag-mo { color: #2ecc71; font-weight: bold; }
        .tag-an { color: #e67e22; font-weight: bold; }
        
        .edit-btn { background: var(--gold); color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; margin-right: 5px; }
        .del-btn { background: var(--danger-red); color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
        
        tr:nth-child(even) { background: #f9f9f9; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="logo.png" alt="Logo" class="logo-img">
        <h1>Master Fee Controller</h1>
        <p>THE LALIT INTERNATIONAL SCHOOL - CONFIGURATION PANEL</p>
    </div>

    <section class="form-section" id="academic-form">
        <span class="section-title">Academic Fee Structure (Class-wise)</span>
        <div class="input-grid">
            <div class="field-group">
                <label>Target Class</label>
                <select id="mClass">
                    <option value="">-- Select --</option>
                    <option value="Pre-Nursery">Pre-Nursery</option>
                    <option value="Nursery">Nursery</option>
                    <option value="LKG">LKG</option>
                    <option value="UKG">UKG</option>
                    <script>for(let i=1; i<=12; i++) document.write(`<option value="${i}">${i}</option>`);</script>
                </select>
            </div>
            <div class="field-group"><label>Admission Fee (An)</label><input type="number" id="mAdmission"></div>
            <div class="field-group"><label>Tuition Fee (Mo)</label><input type="number" id="mTuition"></div>
            <div class="field-group"><label>Development (An)</label><input type="number" id="mDev"></div>
            <div class="field-group"><label>Exam Fee (An)</label><input type="number" id="mExam"></div>
            <div class="field-group"><label>Hostel Fee (Mo)</label><input type="number" id="mHostel"></div>
        </div>
        <button onclick="saveFeeMaster()" class="main-btn" id="saveBtn">Update Academic Structure</button>
    </section>

    <section class="form-section transport-section" id="transport-form">
        <span class="section-title" style="color: var(--accent-purple);">Transport Logistics (Slab-wise)</span>
        <div class="input-grid">
            <div class="field-group">
                <label>Distance Slab</label>
                <select id="tSlab">
                    <option value="">-- Select Distance --</option>
                    <option value="0 - 3 km">0 - 3 km</option>
                    <option value="3 - 6 km">3 - 6 km</option>
                    <option value="6 - 9 km">6 - 9 km</option>
                    <option value="9 - 12 km">9 - 12 km</option>
                    <option value="12 - 15 km">12 - 15 km</option>
                    <option value="15 - 18 km">15 - 18 km</option>
                    <option value="Above 18 km">Above 18 km</option>
                </select>
            </div>
            <div class="field-group">
                <label>Monthly Rate</label>
                <input type="number" id="tAmount" placeholder="₹ Amount">
            </div>
        </div>
        <button onclick="saveTransportFee()" class="main-btn trans-btn" id="saveTransBtn">Update Transport Policy</button>
    </section>

    <div style="display: grid; grid-template-columns: 1fr; gap: 40px; margin-top: 30px;">
        <div>
            <h3 style="color: var(--royal-blue); border-left: 5px solid var(--gold); padding-left: 10px;">Academic Rate Card</h3>
            <table>
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Admission (An)</th>
                        <th>Tuition (Mo)</th>
                        <th>Dev. (An)</th>
                        <th>Exam (An)</th>
                        <th>Hostel (Mo)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="masterFeeBody"></tbody>
            </table>
        </div>

        <div style="max-width: 600px;">
            <h3 style="color: var(--accent-purple); border-left: 5px solid var(--accent-purple); padding-left: 10px;">Transport Rate Card</h3>
            <table>
                <thead>
                    <tr>
                        <th>Distance Slab</th>
                        <th>Monthly Fee</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="transportFeeBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
  authDomain: "the-lalit-d7472.firebaseapp.com",
  projectId: "the-lalit-d7472",
  appId: "1:479237084229:web:31078825739b3c5712ff2c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Academic Logic ---
async function saveFeeMaster() {
    const cls = document.getElementById('mClass').value;
    if(!cls) return alert("Select Class!");
    
    const data = {
        admission: Number(document.getElementById('mAdmission').value) || 0,
        tuition: Number(document.getElementById('mTuition').value) || 0,
        development: Number(document.getElementById('mDev').value) || 0,
        exam: Number(document.getElementById('mExam').value) || 0,
        hostel: Number(document.getElementById('mHostel').value) || 0
    };

    await db.collection('fee_master').doc(cls).set(data);
    alert("Updated Academic Fee for " + cls);
    loadData();
}

async function deleteAcademic(id) {
    if(confirm("Delete fee structure for " + id + "?")) {
        await db.collection('fee_master').doc(id).delete();
        loadData();
    }
}

// --- Transport Logic ---
async function saveTransportFee() {
    const slab = document.getElementById('tSlab').value;
    const amt = document.getElementById('tAmount').value;
    if(!slab || !amt) return alert("Fill all transport fields!");

    await db.collection('transport_master').doc(slab).set({ amount: Number(amt) });
    alert("Transport Updated!");
    loadData();
}

async function deleteTransport(id) {
    if(confirm("Delete transport slab: " + id + "?")) {
        await db.collection('transport_master').doc(id).delete();
        loadData();
    }
}

async function loadData() {
    // Load Academic
    const aSnap = await db.collection('fee_master').get();
    const aBody = document.getElementById('masterFeeBody');
    aBody.innerHTML = "";
    aSnap.forEach(doc => {
        const d = doc.data();
        aBody.innerHTML += `<tr>
            <td><b>${doc.id}</b></td>
            <td class="tag-an">₹${d.admission}</td>
            <td class="tag-mo">₹${d.tuition}</td>
            <td>₹${d.development}</td>
            <td>₹${d.exam}</td>
            <td class="tag-mo">₹${d.hostel}</td>
            <td>
                <button class="edit-btn" onclick="editA('${doc.id}', ${d.admission}, ${d.tuition}, ${d.development}, ${d.exam}, ${d.hostel})">Edit</button>
                <button class="del-btn" onclick="deleteAcademic('${doc.id}')">Del</button>
            </td>
        </tr>`;
    });

    // Load Transport
    const tSnap = await db.collection('transport_master').get();
    const tBody = document.getElementById('transportFeeBody');
    tBody.innerHTML = "";
    tSnap.forEach(doc => {
        const d = doc.data();
        tBody.innerHTML += `<tr>
            <td><b>${doc.id}</b></td>
            <td class="tag-mo">₹${d.amount}</td>
            <td>
                <button class="edit-btn" onclick="editT('${doc.id}', ${d.amount})">Edit</button>
                <button class="del-btn" onclick="deleteTransport('${doc.id}')">Del</button>
            </td>
        </tr>`;
    });
}

function editA(cls, adm, tui, dev, exm, hos) {
    document.getElementById('mClass').value = cls;
    document.getElementById('mAdmission').value = adm;
    document.getElementById('mTuition').value = tui;
    document.getElementById('mDev').value = dev;
    document.getElementById('mExam').value = exm;
    document.getElementById('mHostel').value = hos;
    document.getElementById('academic-form').scrollIntoView({behavior: 'smooth'});
}

function editT(slab, amt) {
    document.getElementById('tSlab').value = slab;
    document.getElementById('tAmount').value = amt;
    document.getElementById('transport-form').scrollIntoView({behavior: 'smooth'});
}

window.onload = loadData;
</script>
<script src="menu.js"></script>
</body>
</html>
