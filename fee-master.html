<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit - Fee & Transport Master</title>
    <style>
        :root {
            --royal-blue: #002366;
            --gold: #D4AF37;
            --deep-gold: #aa8a2e;
            --light-gold: #FDFBF0;
            --white: #ffffff;
            --gray: #666;
            --accent-purple: #8e44ad;
        }

        body {
            background: var(--light-gold);
            margin: 0;
            padding: 20px;
            font-family: 'Georgia', serif;
            color: var(--royal-blue);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 1px solid var(--gold);
        }

        .header {
            text-align: center;
            border-bottom: 3px double var(--gold);
            margin-bottom: 30px;
            padding-bottom: 10px;
        }

        .logo-img {
            max-width: 150px;
            height: auto;
            margin-bottom: 10px;
        }

        .form-section {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            position: relative;
            background: #fcfcfc;
        }

        .transport-section {
            border: 2px solid var(--accent-purple);
            background: #f9f4ff;
        }

        .section-title {
            position: absolute;
            top: -12px; left: 15px;
            background: white;
            padding: 0 10px;
            font-weight: bold;
            color: var(--deep-gold);
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .field-group { display: flex; flex-direction: column; }
        label { font-size: 0.8rem; margin-bottom: 5px; color: var(--gray); font-weight: bold; }

        input, select {
            padding: 10px;
            border: 1px solid #ccc;
            border-bottom: 2px solid var(--gold);
            font-size: 0.9rem;
            outline: none;
        }

        .main-btn {
            width: 100%;
            padding: 15px;
            background: var(--royal-blue);
            color: var(--gold);
            border: none;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            margin-top: 15px;
        }

        .trans-btn {
            background: var(--accent-purple);
            color: white;
        }

        .main-btn:hover { opacity: 0.9; border-radius: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 0.85rem; }
        th { background: var(--royal-blue); color: var(--gold); padding: 12px; border: 1px solid var(--gold); }
        td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        
        .tag-mo { color: #2ecc71; font-weight: bold; }
        .tag-an { color: #e67e22; font-weight: bold; }
        .tag-tr { color: var(--accent-purple); font-weight: bold; }

        .edit-btn { background: var(--gold); color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 3px; margin: 2px; }
        .del-btn { background: #e74c3c; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 3px; }
        tr:nth-child(even) { background: #f9f9f9; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="logo.png" alt="The Lalit Logo" class="logo-img">
        <h1>Fee & Transport Master</h1>
        <p style="letter-spacing: 2px; font-size: 0.8rem;">ADMINISTRATION CONTROL PANEL</p>
    </div>

    <section class="form-section">
        <span class="section-title">Class-wise Fees (Academic)</span>
        <div class="input-grid">
            <div class="field-group">
                <label>Select Class</label>
                <select id="mClass">
                    <option value="">-- Choose Class --</option>
                    <option value="Pre-Nursery">Pre-Nursery</option>
                    <option value="Nursery">Nursery</option>
                    <option value="LKG">LKG</option>
                    <option value="UKG">UKG</option>
                    <option value="Class 1">Class 1</option>
                    <option value="Class 2">Class 2</option>
                    <option value="Class 3">Class 3</option>
                    <option value="Class 4">Class 4</option>
                    <option value="Class 5">Class 5</option>
                    <option value="Class 6">Class 6</option>
                    <option value="Class 7">Class 7</option>
                    <option value="Class 8">Class 8</option>
                    <option value="Class 9">Class 9</option>
                    <option value="Class 10">Class 10</option>
                    <option value="Class 11">Class 11</option>
                    <option value="Class 12">Class 12</option>
                </select>
            </div>
            <div class="field-group"><label>Registration Fee</label><input type="number" id="mReg"></div>
            <div class="field-group"><label>Admission Fee (An)</label><input type="number" id="mAdmission"></div>
            <div class="field-group"><label>Development (An)</label><input type="number" id="mDev"></div>
            <div class="field-group"><label>Exam Fee (An)</label><input type="number" id="mExam"></div>
            <div class="field-group"><label>Tuition (Mo)</label><input type="number" id="mTuition"></div>
            <div class="field-group"><label>Hostel (Mo)</label><input type="number" id="mHostel"></div>
            <div class="field-group"><label>Misc Monthly</label><input type="number" id="mMisc"></div>
        </div>
        <button onclick="saveFeeMaster()" class="main-btn" id="saveBtn">Save Class Fee Structure</button>
    </section>

    <section class="form-section transport-section">
        <span class="section-title" style="color: var(--accent-purple);">Transport Fee (Distance Based)</span>
        <div class="input-grid">
            <div class="field-group">
                <label>Distance Slab</label>
                <select id="tSlab">
                    <option value="">-- Select Distance --</option>
                    <option value="0-3 KM">0-3 KM</option>
                    <option value="3-5 KM">3-5 KM</option>
                    <option value="5-7 KM">5-7 KM</option>
                    <option value="7-10 KM">7-10 KM</option>
                    <option value="10-15 KM">10-15 KM</option>
                    <option value="15-20 KM">15-20 KM</option>
                    <option value="Above 20 KM">Above 20 KM</option>
                </select>
            </div>
            <div class="field-group">
                <label>Monthly Transport Fee</label>
                <input type="number" id="tAmount" placeholder="₹ Enter Amount">
            </div>
        </div>
        <button onclick="saveTransportFee()" class="main-btn trans-btn" id="saveTransBtn">Update Transport Rate</button>
    </section>

    <div style="display: grid; grid-template-columns: 1fr; gap: 30px; margin-top: 20px;">
        <div style="overflow-x:auto;">
            <h3 style="text-align: center; color: var(--royal-blue);">Academic Fee Master</h3>
            <table>
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Reg.</th>
                        <th>Adm.</th>
                        <th>Dev.</th>
                        <th>Exam</th>
                        <th>Tuition</th>
                        <th>Hostel</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="masterFeeBody"></tbody>
            </table>
        </div>

        <div style="overflow-x:auto; max-width: 600px; margin: 0 auto;">
            <h3 style="text-align: center; color: var(--accent-purple);">Transport Fee Master</h3>
            <table>
                <thead>
                    <tr>
                        <th>Distance Slab</th>
                        <th>Monthly Fee</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="transportFeeBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
  authDomain: "the-lalit-d7472.firebaseapp.com",
  projectId: "the-lalit-d7472",
  appId: "1:479237084229:web:31078825739b3c5712ff2c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- ACADEMIC FEE LOGIC ---
async function saveFeeMaster() {
    const cls = document.getElementById('mClass').value;
    if(!cls) { alert("Please select a class!"); return; }
    
    const btn = document.getElementById('saveBtn');
    btn.innerText = "Saving...";
    
    const feeData = {
        className: cls,
        registration: Number(document.getElementById('mReg').value) || 0,
        admission: Number(document.getElementById('mAdmission').value) || 0,
        development: Number(document.getElementById('mDev').value) || 0,
        exam: Number(document.getElementById('mExam').value) || 0,
        tuition: Number(document.getElementById('mTuition').value) || 0,
        hostel: Number(document.getElementById('mHostel').value) || 0,
        misc: Number(document.getElementById('mMisc').value) || 0,
        lastUpdate: new Date().toLocaleString()
    };

    try {
        await db.collection('fee_master').doc(cls).set(feeData);
        alert(cls + " record updated!");
        loadMasterFees();
        resetAcademicForm();
    } catch (e) { alert("Error: " + e.message); }
    finally { btn.innerText = "Save Class Fee Structure"; }
}

async function loadMasterFees() {
    const tableBody = document.getElementById('masterFeeBody');
    tableBody.innerHTML = "<tr><td colspan='8'>Loading...</td></tr>";
    const snapshot = await db.collection('fee_master').orderBy('className').get();
    tableBody.innerHTML = "";
    snapshot.forEach(doc => {
        const d = doc.data();
        tableBody.innerHTML += `<tr>
            <td><b>${d.className}</b></td>
            <td>₹${d.registration}</td>
            <td class="tag-an">₹${d.admission}</td>
            <td class="tag-an">₹${d.development}</td>
            <td class="tag-an">₹${d.exam}</td>
            <td class="tag-mo">₹${d.tuition}</td>
            <td class="tag-mo">₹${d.hostel}</td>
            <td><button class="edit-btn" onclick='editAcademic(${JSON.stringify(d)})'>Edit</button></td>
        </tr>`;
    });
}

function editAcademic(d) {
    document.getElementById('mClass').value = d.className;
    document.getElementById('mReg').value = d.registration;
    document.getElementById('mAdmission').value = d.admission;
    document.getElementById('mDev').value = d.development;
    document.getElementById('mExam').value = d.exam;
    document.getElementById('mTuition').value = d.tuition;
    document.getElementById('mHostel').value = d.hostel;
    document.getElementById('mMisc').value = d.misc;
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- TRANSPORT FEE LOGIC ---
async function saveTransportFee() {
    const slab = document.getElementById('tSlab').value;
    const amount = document.getElementById('tAmount').value;
    
    if(!slab || !amount) { alert("Select Distance & Enter Amount!"); return; }
    
    const btn = document.getElementById('saveTransBtn');
    btn.innerText = "Processing...";

    try {
        await db.collection('transport_master').doc(slab).set({
            slab: slab,
            amount: Number(amount),
            lastUpdate: new Date().toLocaleString()
        });
        alert("Transport slab updated!");
        document.getElementById('tAmount').value = "";
        loadTransportFees();
    } catch (e) { alert("Error: " + e.message); }
    finally { btn.innerText = "Update Transport Rate"; }
}

async function loadTransportFees() {
    const tableBody = document.getElementById('transportFeeBody');
    tableBody.innerHTML = "<tr><td colspan='3'>Loading...</td></tr>";
    const snapshot = await db.collection('transport_master').get();
    tableBody.innerHTML = "";
    snapshot.forEach(doc => {
        const d = doc.data();
        tableBody.innerHTML += `<tr>
            <td><b>${d.slab}</b></td>
            <td class="tag-tr">₹${d.amount}</td>
            <td>
                <button class="edit-btn" onclick="editTransport('${d.slab}', ${d.amount})">Edit</button>
            </td>
        </tr>`;
    });
}

function editTransport(slab, amount) {
    document.getElementById('tSlab').value = slab;
    document.getElementById('tAmount').value = amount;
}

function resetAcademicForm() {
    ['mClass','mReg','mAdmission','mDev','mExam','mTuition','mHostel','mMisc'].forEach(id => {
        document.getElementById(id).value = "";
    });
}

// Initial Load
window.onload = () => {
    loadMasterFees();
    loadTransportFees();
};
</script>
</body>
</html>
