<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class-wise Attendance - The Lalit International School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .attendance-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
        .header-section { background: #2c3e50; color: white; padding: 20px; border-radius: 15px 15px 0 0; margin: -25px -25px 20px -25px; text-align: center; }
        .filter-box { background: #ecf0f1; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dcdde1; }
        .btn-present.active { background-color: #27ae60 !important; color: white !important; }
        .btn-absent.active { background-color: #e74c3c !important; color: white !important; }
    </style>
</head>
<body>

<div class="attendance-container shadow">
    <div class="header-section">
        <h2 id="displayDate">Attendance</h2>
        <p>The Lalit International School</p>
    </div>

    <div class="filter-box">
        <label class="fw-bold mb-1">Select Class to Mark Attendance:</label>
        <select id="classSelector" class="form-select form-select-lg" onchange="loadAttendanceList()">
            <option value="">-- Choose Class --</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="attendanceList">
                <tr><td colspan="3" class="text-center text-muted">Please select a class first</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
        authDomain: "the-lalit-d7472.firebaseapp.com",
        databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com",
        projectId: "the-lalit-d7472",
        storageBucket: "the-lalit-d7472.firebasestorage.app",
        messagingSenderId: "479237084229",
        appId: "1:479237084229:web:f1da384b45c5883b12ff2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const today = new Date().toLocaleDateString('en-GB');
    document.getElementById('displayDate').innerText = "Attendance: " + today;

    function loadAttendanceList() {
        const selectedClass = document.getElementById('classSelector').value;
        const list = document.getElementById('attendanceList');
        
        if(!selectedClass) {
            list.innerHTML = "<tr><td colspan='3' class='text-center text-muted'>Please select a class first</td></tr>";
            return;
        }

        list.innerHTML = "<tr><td colspan='3' class='text-center'>Loading students...</td></tr>";

        db.ref('students').once('value', (snapshot) => {
            list.innerHTML = "";
            let found = false;
            snapshot.forEach((childSnapshot) => {
                const s = childSnapshot.val();
                // Yahan hum sirf wahi bacche dikhayenge jo selected class ke hain
                if(s.class == selectedClass) {
                    found = true;
                    const row = `
                        <tr>
                            <td><b>${s.roll}</b></td>
                            <td>${s.name}</td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-outline-success btn-sm btn-present" onclick="mark('${s.roll}', 'Present', this)">Present</button>
                                    <button class="btn btn-outline-danger btn-sm btn-absent" onclick="mark('${s.roll}', 'Absent', this)">Absent</button>
                                </div>
                            </td>
                        </tr>
                    `;
                    list.innerHTML += row;
                }
            });
            if(!found) {
                list.innerHTML = "<tr><td colspan='3' class='text-center'>No students admitted in Class "+selectedClass+"</td></tr>";
            }
        });
    }

    function mark(roll, status, btn) {
        const dateKey = today.replace(/\//g, "-");
        db.ref('attendance/' + dateKey + '/' + roll).set({
            status: status,
            time: new Date().toLocaleTimeString()
        }).then(() => {
            const parent = btn.parentElement;
            parent.querySelectorAll('button').forEach(b => b.classList.remove('active', 'btn-success', 'btn-danger'));
            btn.classList.add('active');
            if(status === 'Present') btn.classList.add('btn-success');
            else btn.classList.add('btn-danger');
        });
    }
</script>
</body>
</html>
