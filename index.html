<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Dashboard - TLIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="sidebar">
    <div class="logo-box">
        <img src="logo.png" class="school-logo">
        <h5 class="mt-3">The Lalit Intl.</h5>
    </div>
    <div class="nav-links">
        <a href="index.html" class="active"><i class="fas fa-crown me-2"></i> Dashboard</a>
        <a href="add-student.html"><i class="fas fa-scroll me-2"></i> New Admission</a>
        <a href="view-students.html"><i class="fas fa-users me-2"></i> Student List</a>
        <a href="attendance.html"><i class="fas fa-pen-fancy me-2"></i> Attendance</a>
        <a href="fees.html"><i class="fas fa-coins me-2"></i> Fee Collection</a>
        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="royal-card">
        <h2 class="text-center mb-4" style="border-bottom: 2px solid var(--gold); padding-bottom: 10px;">Imperial School Overview</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Total Registered Souls</h6>
                    <h2 id="totalCount">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Presence Today</h6>
                    <h2 id="presentCount">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Treasury (Recent)</h6>
                    <h2 id="feeCount">0</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
        authDomain: "the-lalit-d7472.firebaseapp.com",
        databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com",
        projectId: "the-lalit-d7472",
        storageBucket: "the-lalit-d7472.firebasestorage.app",
        messagingSenderId: "479237084229",
        appId: "1:479237084229:web:f1da384b45c5883b12ff2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Security Lock (Auth Guard)
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) { window.location.href = "login.html"; }
        else { updateStats(); }
    });

    function updateStats() {
        db.ref('students').on('value', snap => { document.getElementById('totalCount').innerText = snap.numChildren(); });
        const today = new Date().toLocaleDateString('en-GB').replace(/\//g, "-");
        db.ref('attendance/' + today).on('value', snap => {
            let p = 0; snap.forEach(c => { if(c.val().status==='Present') p++; });
            document.getElementById('presentCount').innerText = p;
        });
    }

    function logout() { firebase.auth().signOut().then(() => { window.location.href = "login.html"; }); }
</script>
</body>
</html>
