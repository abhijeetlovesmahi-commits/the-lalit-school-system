<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit Intl. School - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<input type="checkbox" id="menu-checkbox">
<label for="menu-checkbox" class="menu-toggle"><span></span><span></span><span></span></label>
<label for="menu-checkbox" class="sidebar-overlay"></label>
    
<div class="sidebar">
    <div class="logo-box">
        <img src="logo.png" class="school-logo">
        <h5 class="mt-3" style="font-family: 'Cinzel', serif; color: #5d4037;">The Lalit Intl.</h5>
    </div>
    <div class="nav-links">
        <a href="index.html" class="active"><i class="fas fa-crown me-2"></i> Dashboard</a>
        <a href="add-student.html"><i class="fas fa-scroll me-2"></i> New Admission</a>
        <a href="view-students.html"><i class="fas fa-users me-2"></i> Student List</a>
        <a href="attendance.html"><i class="fas fa-pen-fancy me-2"></i> Attendance</a>
        <a href="fees.html"><i class="fas fa-coins me-2"></i> Fee Collection</a>
        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="royal-card">
        <h2 class="text-center mb-4">IMPERIAL OVERVIEW</h2>
        
        <div class="row g-4 mb-4">
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Total Registered Souls</h6>
                    <h2 id="totalCount" style="color: #ff9800;">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Presence Today</h6>
                    <h2 id="presentCount" style="color: #2e7d32;">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Treasury (Recent)</h6>
                    <h2 id="feeCount" style="color: #bf360c;">0</h2>
                </div>
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e0d0b0; display: flex; flex-direction: column; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <h5 style="font-family: 'Poppins', sans-serif; color: #8d6e63; margin-bottom: 15px;">STRENGTH DISTRIBUTION</h5>
            <div style="width: 250px; height: 250px;">
                <canvas id="schoolPieChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
        authDomain: "the-lalit-d7472.firebaseapp.com",
        databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com",
        projectId: "the-lalit-d7472",
        storageBucket: "the-lalit-d7472.firebasestorage.app",
        messagingSenderId: "479237084229",
        appId: "1:479237084229:web:f1da384b45c5883b12ff2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Security & Stats
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) { window.location.href = "login.html"; }
        else { updateStats(); }
    });

    function updateStats() {
        // Total Students
        db.ref('students').on('value', snap => { 
            const count = snap.numChildren();
            document.getElementById('totalCount').innerText = count; 
            updateChart(count); // Chart ko update karne ke liye
        });

        // Attendance
        const today = new Date().toLocaleDateString('en-GB').replace(/\//g, "-");
        db.ref('attendance/' + today).on('value', snap => {
            let p = 0; snap.forEach(c => { if(c.val().status==='Present') p++; });
            document.getElementById('presentCount').innerText = p;
        });
    }

    function logout() { firebase.auth().signOut().then(() => { window.location.href = "login.html"; }); }

    // PIE CHART LOGIC
    const ctx = document.getElementById('schoolPieChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Total Students', 'Others'],
            datasets: [{
                data: [0, 100], 
                backgroundColor: ['#ff9800', '#eee'],
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    function updateChart(count) {
        myChart.data.datasets[0].data = [count, count > 500 ? 0 : 500 - count];
        myChart.update();
    }
</script>
</body>
</html>
