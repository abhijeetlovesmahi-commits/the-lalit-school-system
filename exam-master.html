<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit - Exam Master</title>
    <style>
        :root {
            --royal-blue: #002366; --gold: #D4AF37; --deep-gold: #aa8a2e;
            --light-gold: #FDFBF0; --white: #ffffff; --danger: #c0392b;
        }

        body { background: var(--light-gold); margin: 0; padding: 40px 20px; font-family: 'Georgia', serif; color: var(--royal-blue); }

        .container {
            max-width: 1000px; margin: 0 auto; background: var(--white);
            padding: 50px; border-radius: 5px; box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            border: 1px solid var(--gold); position: relative;
        }

        .container::before {
            content: ""; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid var(--gold); pointer-events: none; opacity: 0.5;
        }

        .header { text-align: center; border-bottom: 3px double var(--gold); margin-bottom: 40px; padding-bottom: 20px; }
        .school-logo { width: 110px; margin-bottom: 10px; }

        h1 { text-transform: uppercase; letter-spacing: 4px; font-size: 2.2rem; margin: 10px 0; color: var(--royal-blue); }

        .form-section { margin-bottom: 35px; border: 1px solid #eee; padding: 25px; background: #fff; position: relative; }

        .section-title {
            position: absolute; top: -12px; left: 20px; background: white;
            padding: 0 15px; font-weight: bold; color: var(--deep-gold);
            text-transform: uppercase; font-size: 0.9rem;
        }

        .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }

        input, select {
            padding: 12px; border: 1px solid #ccc; background: #fff; font-size: 1rem;
            border-bottom: 2px solid var(--gold); outline: none; width: 100%; box-sizing: border-box;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 15px; text-align: left; font-size: 0.9rem; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        .main-btn {
            width: 100%; padding: 20px; background: var(--royal-blue); color: var(--gold);
            border: 1px solid var(--gold); font-size: 1.3rem; font-weight: bold;
            cursor: pointer; letter-spacing: 2px; transition: 0.3s; margin-top: 20px;
        }

        .main-btn:hover { background: #001a4d; }

        .btn-small { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; border: 1px solid var(--gold); font-weight: bold; }
        .btn-add { background: var(--gold); color: white; }
        .btn-reset { background: #666; color: white; border: none; }
        .btn-del { background: var(--danger); color: white; border: none; }

        #status { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

    <script src="firebase-config.js"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="logo.png" alt="Logo" class="school-logo">
        <h1>Exam Master Settings</h1>
        <p style="letter-spacing: 5px; font-size: 0.8rem; color: var(--deep-gold);">ACADEMIC CONFIGURATION PANEL</p>
    </div>

    <section class="form-section">
        <span class="section-title">Examination Details</span>
        <div class="config-grid">
            <div>
                <label style="font-size: 0.8rem; font-weight: bold;">Exam Type</label>
                <select id="examType" onchange="autoPopulate()">
                    <option value="">-- Select Exam --</option>
                    <option value="Formative Test -I">Formative Test -I</option>
                    <option value="Periodic Test -I">Periodic Test -I</option>
                    <option value="Term -I">Term -I</option>
                    <option value="Formative Test -II">Formative Test -II</option>
                    <option value="Periodic -II">Periodic -II</option>
                    <option value="Term -II">Term -II</option>
                </select>
            </div>
            <div>
                <label style="font-size: 0.8rem; font-weight: bold;">Class</label>
                <select id="examClass" onchange="autoPopulate()">
                    <option value="">-- Select Class --</option>
                    <option value="Pre-Nursery">Pre-Nursery</option>
                    <option value="Nursery">Nursery</option>
                    <option value="LKG">LKG</option>
                    <option value="UKG">UKG</option>
                    <script>
                        for(let i=1; i<=12; i++) document.write(`<option value="${i}">Class ${i}</option>`);
                    </script>
                </select>
            </div>
            <div>
                <label style="font-size: 0.8rem; font-weight: bold;">Exam Date</label>
                <input type="date" id="examDate">
            </div>
        </div>
    </section>

    <section class="form-section">
        <span class="section-title">Subject & Marks Mapping</span>
        <table id="subjectTable">
            <thead>
                <tr>
                    <th>Subject Name</th>
                    <th style="width: 150px;">Full Marks</th>
                    <th style="width: 100px;">Action</th>
                </tr>
            </thead>
            <tbody id="subjectBody"></tbody>
        </table>
        <div style="margin-top: 20px; display: flex; gap: 10px;">
            <button class="btn-small btn-add" onclick="addRow('', 0)">+ ADD SUBJECT</button>
            <button class="btn-small btn-reset" onclick="autoPopulate()">RESET TO DEFAULT</button>
        </div>
    </section>

    <button class="main-btn" onclick="saveExamSettings()">SAVE EXAM CONFIGURATION</button>
    <div id="status"></div>
</div>

<script>
const defaultSubjects = [
    "English", "Hindi", "Sanskrit", "Science", "Social Science", 
    "Mathematics", "Computer", "General Knowledge", "Moral Education", "Drawing"
];

function getMarksByExam(examType) {
    if(examType.includes("Term")) return 80;
    if(examType.includes("Periodic")) return 40;
    return 20; 
}

function autoPopulate() {
    const examType = document.getElementById('examType').value;
    const sClass = document.getElementById('examClass').value;
    const tbody = document.getElementById('subjectBody');
    if(!examType || !sClass) return;

    const marks = getMarksByExam(examType);
    tbody.innerHTML = ""; 
    defaultSubjects.forEach(sub => addRow(sub, marks));
}

function addRow(name = "", marks = "") {
    const tbody = document.getElementById('subjectBody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
        <td><input type="text" class="sub-name" value="${name}"></td>
        <td><input type="number" class="sub-marks" value="${marks}"></td>
        <td><button class="btn-small btn-del" onclick="this.parentElement.parentElement.remove()">DEL</button></td>
    `;
    tbody.appendChild(tr);
}

async function saveExamSettings() {
    const examType = document.getElementById('examType').value;
    const sClass = document.getElementById('examClass').value;
    const examDate = document.getElementById('examDate').value;
    const status = document.getElementById('status');

    if(!examType || !sClass || !examDate) {
        alert("Pehle Exam Type, Class aur Date select karein.");
        return;
    }

    const subjects = [];
    document.querySelectorAll('#subjectBody tr').forEach(row => {
        const name = row.querySelector('.sub-name').value;
        const marks = row.querySelector('.sub-marks').value;
        if(name) subjects.push({ subjectName: name, fullMarks: Number(marks) });
    });

    const docId = `${sClass}_${examType}`.replace(/\s+/g, '');

    try {
        await db.collection('exam_settings').doc(docId).set({
            class: sClass,
            examType: examType,
            examDate: examDate,
            subjects: subjects,
            timestamp: Date.now()
        });
        status.innerHTML = `<span style="color:green;">âœ“ Settings saved for ${sClass} - ${examType}</span>`;
    } catch (err) {
        status.innerHTML = `<span style="color:red;">Error: ${err.message}</span>`;
    }
}
</script>
<script src="menu.js"></script>
</body>
</html>
